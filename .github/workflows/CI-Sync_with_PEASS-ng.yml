name: Sync adPEASS with PEASS-ng & Create Pull Request

on:
  push

jobs:

  sync-adPEAS:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        repository: 'toxicphreAK/PEASS-ng'
    - name: Add adPEAS as remote
      run: git remote add adPEAS https://github.com/toxicphreAK/adPEAS
    #- name: Check remotes
    #  run: git remote -v
    - name: Fetch adPEAS
      run: git fetch adPEAS --no-tags
    - name: Pulls from adPEAS main (if not already present will add it as subtree)
      uses: actions/github-script@v6
      with:
        result-encoding: string
        script: |
          try {
            git subtree pull --prefix=adPEAS adPEAS main --squash
          } catch(err) {
            git subtree add --prefix=adPEAS adPEAS main --squash
          }
    #- name: Pull from main branch
    #  run: git subtree add --prefix=adPEAS adPEAS main --squash
    - name: Create Pull Request on PEASS-ng
      uses: peter-evans/create-pull-request@v5
      with:
        title: Sync adPEAS changes
        body: Automated sync of changes by GH actions. For details, see [adPEAS Repo](https://github.com/61106960/adPEAS)
